<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="MemberMapper">
  
  <resultMap type="Member" id="MemberMap">
    <id column="member_no" property="no"/> 
    <result column="name" property="name"/>
    <result column="id" property="id"/>
    <result column="password" property="password"/>
    <result column="birth" property="birthDay"/>
    <result column="email" property="email"/>
    <result column="tel" property="phoneNum"/>
    <result column="photo" property="photo"/>
    <result column="sex" property="sex"/>
    <result column="created_dt" property="registeredDate"/>
    <result column="role" property="doctorOrNot"/>
    <result column="point" property="point"/>
    <result column="active" property="active"/>
    
    <association property="doctor" javaType="Doctor">
      <id column="doctor_no" property="no"/>
      <result column="major" property="major"/>
      <result column="license" property="license"/>
      <result column="homepage" property="homepage"/>
      <result column="introduction" property="introduction"/>
    </association>
    
  </resultMap>
  
  
  <select id="findAll" resultMap="MemberMap">
    select
       m.member_no,
       m.name,
       m.id,
       m.password,
       m.birth,
       m.email,
       m.tel,
       m.photo,
       m.sex,
       m.created_dt,
       m.point,
       m.role,
       m.active,
       d.doctor_no,
       d.major,
       d.license,
       d.homepage,
       d.introduction
    from
      apus_member m
      inner join apus_doctor d on m.member_no=d.doctor_no
    order by
      member_no asc
  </select>
  
<<<<<<< HEAD
    <select id="check" resultMap="MemberMap">
    select
      id
    from
      apus_member
  </select>
  
   <select id="findByIdPwd" resultMap="MemberMap" parameterType="map">
     select
        member_no,
        name,
        id,
        password,
        birth,
        tel,
        email,
       photo,
       sex,
        created_dt,
        point,
        role,
        active
     from
       apus_member
     where id=#{id} and password=password(#{password})
   </select>
   
   <insert id="insert" parameterType="member" 
   useGeneratedKeys="true" keyColumn="member_no" keyProperty="no">
=======
	<select id="findByIdPwd" resultMap="MemberMap" parameterType="map">
	  select
		  member_no,
		  name,
		  id,
		  password,
		  birth,
		  tel,
		  email,
	    photo,
	    sex,
		  created_dt,
		  point,
		  role,
		  active
	  from
	    apus_member
	  where id=#{id} and password=password(#{password})
	</select>
	
	<insert id="insert" parameterType="member" 
	useGeneratedKeys="true" keyColumn="member_no" keyProperty="no">
>>>>>>> 479a8926e7d17e29ac14c373e106dac7c93979e0
    insert into apus_member(name,id,password,birth,tel,email,photo,sex,point,role)
    values(#{name},#{id},password(#{password}),#{birthDay},#{phoneNum},#{email},
     #{photo},#{sex},#{point},#{doctorOrNot})
   </insert>
   
   <insert id="insert2" parameterType="member">
   insert into apus_doctor(doctor_no,major,license,homepage,introduction)
   values(#{no},#{doctor.major},#{doctor.license},#{doctor.homepage},#{doctor.introduction})
  </insert>
   
   <update id="update" parameterType="member">
    update apus_member set
      name=#{name},
      id=#{id},
      password=password(#{password}),
      birth=#{birthDay},
      tel=#{phoneNum},
      email=#{email},
      photo=#{photo},
      sex=#{sex},
      point=#{point},
      role=#{doctorOrNot}
    where member_no=#{values}
   </update>
    
   <delete id="delete" parameterType="string">
    delete from apus_member
    where id=#{id}
   </delete>
   
   <select id="findById" resultMap="MemberMap" parameterType="string">
    select
      member_no,
      name,
      id,
      password,
      birth,
      tel,
      email,
      photo,
      sex,
      created_dt,
      point,
      role,
      active
    from
      apus_member
    where id=#{id}
   </select>
   
   <select id="findByName" resultMap="MemberMap" parameterType="string">
   select
      member_no,
      name,
      id,
      password,
      birth,
      tel,
      email,
      photo,
      sex,
      created_dt,
      point,
      role,
      active
    from
      apus_member
    where name=#{name}
  </select>
  
</mapper>






